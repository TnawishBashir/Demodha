@model Demodha.ViewModels.OwnerDashboardVM
@{
    ViewData["Title"] = "Owner Dashboard";
    Layout = "_Layout.Owner";
}

<div class="d-flex flex-wrap align-items-center justify-content-between gap-2 mb-3">
    <div>
        <h3 class="mb-1 fw-bold">Owner / Seller Dashboard</h3>
        <div class="text-muted">Create NDC application, upload documents, then submit to Dealer.</div>
    </div>

    <div class="d-flex gap-2">
        <a class="btn btn-primary" href="/Owner/Applications/Create">+ New Application</a>
        <a class="btn btn-outline-secondary" href="/Owner/Applications">Upload Documents</a>
    </div>
</div>

<div class="row g-3 mb-3">
    <div class="col-6 col-lg-3">
        <div class="border rounded-4 p-3 bg-white">
            <div class="text-muted">Total Applications</div>
            <div class="fs-3 fw-bold">@Model.Total</div>
        </div>
    </div>
    <div class="col-6 col-lg-3">
        <div class="border rounded-4 p-3 bg-white">
            <div class="text-muted">Draft</div>
            <div class="fs-3 fw-bold">@Model.Draft</div>
        </div>
    </div>
    <div class="col-6 col-lg-3">
        <div class="border rounded-4 p-3 bg-white">
            <div class="text-muted">Submitted to Dealer</div>
            <div class="fs-3 fw-bold">@Model.SubmittedToDealer</div>
        </div>
    </div>
    <div class="col-6 col-lg-3">
        <div class="border rounded-4 p-3 bg-white">
            <div class="text-muted">Returned / Objections</div>
            <div class="fs-3 fw-bold">@Model.Returned</div>
        </div>
    </div>
</div>

<div class="row g-3">
    <div class="col-12 col-lg-8">
        <div class="border rounded-4 p-3 bg-white">
            <div class="d-flex align-items-center justify-content-between mb-2">
                <div class="fw-bold">My Applications</div>
                <a href="/Owner/Applications" class="text-decoration-none">View all</a>
            </div>

            <div class="table-responsive">
                <table class="table align-middle mb-0">
                    <thead>
                        <tr class="text-muted">
                            <th>App #</th>
                            <th>Plot / File</th>
                            <th>Status</th>
                            <th style="width:180px;">Progress</th>
                            <th class="text-end">Action</th>
                        </tr>
                    </thead>
                    <tbody>
                        @if (Model.Applications == null || !Model.Applications.Any())
                        {
                            <tr>
                                <td colspan="5" class="text-center text-muted py-4">
                                    No applications found. Click <b>New Application</b> to create your first NDC request.
                                </td>
                            </tr>
                        }
                        else
                        {
                            foreach (var a in Model.Applications)
                            {
                                <tr>
                                    <td class="fw-semibold">@a.AppNo</td>
                                    <td>
                                        @a.Plot
                                        <div class="text-muted small">Last update: @a.Updated</div>
                                    </td>
                                    <td>
                                        <span class="badge bg-@a.Badge">@a.StatusText</span>
                                    </td>
                                    <td>
                                        <div class="progress" style="height:10px;">
                                            <div class="progress-bar" role="progressbar" style="width:@a.Progress%"></div>
                                        </div>
                                        <div class="small text-muted mt-1">@a.Progress% complete</div>
                                    </td>
                                    <td class="text-end">
                                        <a class="btn btn-sm btn-outline-primary" href="/Owner/Applications/View/@a.Id">Open</a>
                                    </td>
                                </tr>
                            }
                        }
                    </tbody>
                </table>
            </div>

        </div>
    </div>

    <div class="col-12 col-lg-4">
        <div class="border rounded-4 p-3 bg-white mb-3">
            <div class="fw-bold mb-2">Step-1 Document Checklist</div>

            @if (Model.DocChecklist == null || !Model.DocChecklist.Any())
            {
                <div class="text-muted small">
                    No draft application found. Create a new application to see the Step-1 checklist here.
                </div>
            }
            else
            {
                foreach (var d in Model.DocChecklist)
                {
                    <div class="d-flex align-items-start justify-content-between py-2 border-bottom">
                        <div>
                            <div class="fw-semibold">@d.Name</div>
                            <div class="text-muted small">@d.Note</div>
                        </div>
                        <div>
                            @if (d.Done)
                            {
                                <span class="badge bg-success">Done</span>
                            }
                            else
                            {
                                <span class="badge bg-secondary">Pending</span>
                            }
                        </div>
                    </div>
                }

                <div class="mt-3 d-grid gap-2">
                    @if (Model.LatestDraftId.HasValue)
                    {
                        <a class="btn btn-outline-secondary" href="/Owner/Applications/UploadDocs/@Model.LatestDraftId">
                            Upload Missing Docs
                        </a>
                    }
                    else
                    {
                        <a class="btn btn-outline-secondary disabled" href="#">
                            Upload Missing Docs
                        </a>
                    }

                    <a class="btn btn-primary" href="#">Submit to Dealer</a>
                </div>

            }
        </div>

        <div class="border rounded-4 p-3 bg-white">
            <div class="fw-bold mb-2">Recent Activity</div>

            @if (Model.Activity == null || !Model.Activity.Any())
            {
                <div class="text-muted">No recent activity.</div>
            }
            else
            {
                foreach (var x in Model.Activity)
                {
                    <div class="py-2 border-bottom">
                        <div class="small text-muted">@x.When</div>
                        <div>@x.Text</div>
                    </div>
                }
            }
        </div>
    </div>
</div>

<div class="mt-3 border rounded-4 p-3 bg-white">
    <div class="fw-bold mb-1">What happens next?</div>
    <div class="text-muted">
        Once you submit, Dealer will attach Challan + Consent forms. After that, Transfer Desk will route your case to Plans/Legal/Land/BC/Finance for clearance.
        Typical NDC clearance time is ~5 working days (as per process).
    </div>
</div>
